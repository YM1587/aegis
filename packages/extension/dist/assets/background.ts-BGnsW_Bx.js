import{D as c}from"./index-Cfz1CtDu.js";const r="ruleset_1",o="src/offscreen.html";let t=null;async function s(e){await chrome.offscreen.hasDocument()||(t?await t:(t=chrome.offscreen.createDocument({url:e,reasons:[chrome.offscreen.Reason.WORKERS||"WORKERS"],justification:"Run AI model for content analysis"}),await t,t=null))}chrome.runtime.onInstalled.addListener(async()=>{chrome.storage.local.set({protectionStatus:c}),console.log("Aegis extension installed"),await s(o)});chrome.runtime.onStartup.addListener(async()=>{await s(o)});chrome.runtime.onMessage.addListener((e,n,a)=>{if(e.target==="offscreen")return s(o).then(()=>{chrome.runtime.sendMessage(e,a)}),!0});chrome.storage.onChanged.addListener(e=>{if(e.protectionStatus){const n=e.protectionStatus.newValue.isEnabled;i(n)}});async function i(e){try{await chrome.declarativeNetRequest.updateEnabledRulesets({enableRulesetIds:e?[r]:[],disableRulesetIds:e?[]:[r]}),console.log(`Blocking rules ${e?"enabled":"disabled"}`)}catch(n){console.error("Failed to update blocking rules:",n)}}
